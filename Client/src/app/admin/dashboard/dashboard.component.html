<div class="dashboard-container">
  <!-- Header Section -->
  <div class="dashboard-header">
    <h1 class="dashboard-title">Dashboard</h1>
    <div class="header-actions">
      <button class="action-btn" (click)="navigateToProfile()" title="Profile">
        <i class="fas fa-user-circle"></i>
        <span>Profile</span>
      </button>
      <button class="action-btn theme-toggle-btn" (click)="themeService.toggleTheme()" [attr.aria-label]="themeService.currentTheme() === 'light' ? 'Switch to dark mode' : 'Switch to light mode'">
        <i [class]="themeService.currentTheme() === 'light' ? 'fas fa-moon' : 'fas fa-sun'"></i>
        <span>{{ themeService.currentTheme() === 'light' ? 'Dark' : 'Light' }}</span>
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading()" class="dashboard-content">
    <!-- KPI Cards Row 1 -->
    <div class="kpi-cards-row">
      <div *ngFor="let card of kpiCards()" class="kpi-card clickable-card" (click)="onKPICardClick(card.type!)">
        <div class="kpi-icon" [style.background]="card.gradient">
          <i [class]="card.icon"></i>
        </div>
        <div class="kpi-content">
          <h3 class="kpi-value">{{ card.value }}</h3>
          <p class="kpi-title">{{ card.title }}</p>
        </div>
      </div>
    </div>


    <!-- Calendar View -->
    <div *ngIf="currentViewMode() === 'calendar'" class="dashboard-row">
      <div class="calendar-card full-width">
        <div class="card-header-custom">
          <h3 class="card-title-custom">
            <i class="fas fa-calendar-alt"></i>
            Upcoming Classes
          </h3>
        </div>
        <div class="card-body-custom">
          <full-calendar [options]="calendarOptions"></full-calendar>
        </div>
      </div>
    </div>

    <!-- Table Views -->
    <div *ngIf="currentViewMode() === 'table'" class="dashboard-row">
      <div class="table-card full-width">
        <div class="card-header-custom">
          <div class="d-flex justify-content-between align-items-center">
            <h3 class="card-title-custom">
              <i class="fas fa-table"></i>
              {{ getTableTitle() }}
            </h3>
            <button class="btn btn-outline-secondary btn-sm" (click)="backToCalendar()">
              <i class="fas fa-arrow-left"></i>
              Back to Calendar
            </button>
          </div>
        </div>
        <div class="card-body-custom">
          <!-- Students Table -->
          <div *ngIf="selectedTableType() === 'students'" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Status</th>
                  <th>Created Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let student of detailedStudents()">
                  <td>{{ student.userId }}</td>
                  <td>{{ student.fullName }}</td>
                  <td>{{ student.email }}</td>
                  <td>{{ student.phone || 'N/A' }}</td>
                  <td>
                    <span class="badge" [class]="getStatusBadgeClass(student.status)">
                      {{ student.status }}
                    </span>
                  </td>
                  <td>{{ student.createdAt | date:'mediumDate' }}</td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="detailedStudents().length === 0" class="text-center py-4">
              <i class="fas fa-users fa-3x text-muted mb-3"></i>
              <p class="text-muted">No students found</p>
            </div>
          </div>

          <!-- Teachers Table -->
          <div *ngIf="selectedTableType() === 'teachers'" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Status</th>
                  <th>Created Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let teacher of detailedTeachers()">
                  <td>{{ teacher.userId }}</td>
                  <td>{{ teacher.fullName }}</td>
                  <td>{{ teacher.email }}</td>
                  <td>{{ teacher.phone || 'Not Provided' }}</td>
                  <td>
                    <span class="badge" [class]="getStatusBadgeClass(teacher.status)">
                      {{ teacher.status }}
                    </span>
                  </td>
                  <td>{{ teacher.createdAt | date:'mediumDate' }}</td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="detailedTeachers().length === 0" class="text-center py-4">
              <i class="fas fa-chalkboard-teacher fa-3x text-muted mb-3"></i>
              <p class="text-muted">No teachers found</p>
            </div>
          </div>

          <!-- Courses Table -->
          <div *ngIf="selectedTableType() === 'courses'" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Course Name</th>
                  <th>Description</th>
                  <th>Created By</th>
                  <th>Created Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let course of detailedCourses()">
                  <td>{{ course.courseId }}</td>
                  <td>{{ course.courseName }}</td>
                  <td>{{ course.description || 'N/A' }}</td>
                  <td>{{ course.createdBy }}</td>
                  <td>{{ course.createdAt | date:'mediumDate' }}</td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="detailedCourses().length === 0" class="text-center py-4">
              <i class="fas fa-book fa-3x text-muted mb-3"></i>
              <p class="text-muted">No courses found</p>
            </div>
          </div>

          <!-- Demo Bookings Table -->
          <div *ngIf="selectedTableType() === 'demo_pending'" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Parent Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Child Name</th>
                  <th>Child Age</th>
                  <th>Preferred Course</th>
                  <th>Preferred Date</th>
                  <th>Preferred Time</th>
                  <th>Message</th>
                  <th>Status</th>
                  <th>Created Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let booking of detailedDemoBookings()">
                  <td>{{ booking.id }}</td>
                  <td>{{ booking.parentName || booking.name }}</td>
                  <td>{{ booking.email }}</td>
                  <td>{{ booking.phone }}</td>
                  <td>{{ booking.childName }}</td>
                  <td>{{ booking.childAge }}</td>
                  <td>{{ booking.preferredCourse }}</td>
                  <td>{{ booking.preferredDate }}</td>
                  <td>{{ booking.preferredTime }}</td>
                  <td>{{ booking.message | slice:0:50 }}{{ booking.message?.length > 50 ? '...' : '' }}</td>
                  <td>
                    <span class="badge" [class]="getStatusBadgeClass(booking.status)">
                      {{ booking.status || 'PENDING' }}
                    </span>
                  </td>
                  <td>{{ booking.createdAt | date:'mediumDate' }}</td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="detailedDemoBookings().length === 0" class="text-center py-4">
              <i class="fas fa-calendar-plus fa-3x text-muted mb-3"></i>
              <p class="text-muted">No pending demo requests found</p>
            </div>
          </div>

          <!-- Contacts Table -->
          <div *ngIf="selectedTableType() === 'contact_pending'" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Subject</th>
                  <th>Message</th>
                  <th>Status</th>
                  <th>Created Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let contact of detailedContacts()">
                  <td>{{ contact.id }}</td>
                  <td>{{ contact.name }}</td>
                  <td>{{ contact.email }}</td>
                  <td>{{ contact.phone }}</td>
                  <td>{{ contact.subject }}</td>
                  <td>{{ contact.message | slice:0:50 }}{{ contact.message?.length > 50 ? '...' : '' }}</td>
                  <td>
                    <span class="badge" [class]="getStatusBadgeClass(contact.status)">
                      {{ contact.status || 'PENDING' }}
                    </span>
                  </td>
                  <td>{{ contact.createdAt | date:'mediumDate' }}</td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="detailedContacts().length === 0" class="text-center py-4">
              <i class="fas fa-envelope-open-text fa-3x text-muted mb-3"></i>
              <p class="text-muted">No pending contact requests found</p>
            </div>
          </div>

          <!-- Feedback Table -->
          <div *ngIf="selectedTableType() === 'feedback_pending'" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Rating</th>
                  <th>Child Name</th>
                  <th>Child Age</th>
                  <th>Course</th>
                  <th>Message</th>
                  <th>Status</th>
                  <th>Created Date</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let feedback of detailedFeedbacks()">
                  <td>{{ feedback.id }}</td>
                  <td>{{ feedback.name }}</td>
                  <td>{{ feedback.email }}</td>
                  <td>
                    <div class="stars">
                      <i *ngFor="let star of [].constructor(feedback.rating)" class="fas fa-star text-warning"></i>
                    </div>
                  </td>
                  <td>{{ feedback.childName }}</td>
                  <td>{{ feedback.childAge }}</td>
                  <td>{{ feedback.course }}</td>
                  <td>{{ feedback.message | slice:0:50 }}{{ feedback.message?.length > 50 ? '...' : '' }}</td>
                  <td>
                    <span class="badge" [class]="getStatusBadgeClass(feedback.isApproved ? 'APPROVED' : 'PENDING')">
                      {{ feedback.isApproved ? 'APPROVED' : 'PENDING' }}
                    </span>
                  </td>
                  <td>{{ feedback.createdAt | date:'mediumDate' }}</td>
                </tr>
              </tbody>
            </table>
            <div *ngIf="detailedFeedbacks().length === 0" class="text-center py-4">
              <i class="fas fa-comments fa-3x text-muted mb-3"></i>
              <p class="text-muted">No pending feedback requests found</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

